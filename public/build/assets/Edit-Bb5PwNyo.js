import{r as m,u as U,j as e,L as W,a as T}from"./app-D6Aoihes.js";import{L as O,S as F,A as p}from"./AnimatedSection-Dw2gx274.js";const G=["Sunny","Partly Cloudy","Cloudy","Light Rain","Heavy Rain","Windy","Hot","Cold"],V=["Mason","Carpenter","Electrician","Plumber","Laborer","Foreman","Engineer","Welder","Painter","Other"],z=["bags","tons","kg","cubic meters","cubic feet","pieces","liters","gallons","meters","feet","sheets","bundles","rolls"];function K({meta:S,project:M,log:l}){const[h,f]=m.useState([]),[x,v]=m.useState([]),[u,w]=m.useState([]),[k,$]=m.useState([]),[d,y]=m.useState([]),[_,C]=m.useState(!1),j=m.useRef(null);m.useEffect(()=>{l.workers.length>0?f(l.workers.map(t=>{var s;return{id:t.id,worker_name:t.worker_name,role:t.role||"",hours_worked:((s=t.hours_worked)==null?void 0:s.toString())||"",tasks_performed:t.tasks_performed||""}})):f([{worker_name:"",role:"",hours_worked:"",tasks_performed:""}]),l.materials.length>0?v(l.materials.map(t=>{var s;return{id:t.id,material_name:t.material_name,quantity:t.quantity.toString(),unit:t.unit,unit_cost:((s=t.unit_cost)==null?void 0:s.toString())||"",supplier:t.supplier||"",notes:t.notes||""}})):v([{material_name:"",quantity:"",unit:"bags",unit_cost:"",supplier:"",notes:""}]),l.images&&l.images.length>0&&$(l.images)},[l]);const L=t=>t?t.substring(0,5):"",{data:o,setData:c,errors:b}=U({work_date:l.work_date.split("T")[0],start_time:L(l.start_time),end_time:L(l.end_time),work_description:l.work_description,difficulties:l.difficulties||"",weather_conditions:l.weather_conditions||"",safety_notes:l.safety_notes||"",additional_notes:l.additional_notes||"",workers:[],materials:[]}),E=()=>{f([...h,{worker_name:"",role:"",hours_worked:"",tasks_performed:""}])},I=t=>{f(h.filter((s,a)=>a!==t))},N=(t,s,a)=>{const r=[...h];s!=="id"&&(r[t][s]=a),f(r)},A=()=>{v([...x,{material_name:"",quantity:"",unit:"bags",unit_cost:"",supplier:"",notes:""}])},q=t=>{v(x.filter((s,a)=>a!==t))},g=(t,s,a)=>{const r=[...x];s!=="id"&&(r[t][s]=a),v(r)},R=t=>{const s=t.target.files;if(!s)return;const a=[];Array.from(s).forEach(r=>{r.type.startsWith("image/")&&a.push({file:r,preview:URL.createObjectURL(r),caption:""})}),w([...u,...a]),j.current&&(j.current.value="")},B=t=>{const s=[...u];URL.revokeObjectURL(s[t].preview),s.splice(t,1),w(s)},D=(t,s)=>{const a=[...u];a[t].caption=s,w(a)},H=t=>{d.includes(t)?y(d.filter(s=>s!==t)):y([...d,t])},P=t=>{t.preventDefault();const s=h.filter(n=>n.worker_name.trim()),a=x.filter(n=>n.material_name.trim()),r=new FormData;r.append("_method","PUT"),r.append("work_date",o.work_date),r.append("start_time",o.start_time),r.append("end_time",o.end_time),r.append("work_description",o.work_description),r.append("difficulties",o.difficulties),r.append("weather_conditions",o.weather_conditions),r.append("safety_notes",o.safety_notes),r.append("additional_notes",o.additional_notes),s.forEach((n,i)=>{n.id&&r.append(`workers[${i}][id]`,n.id.toString()),r.append(`workers[${i}][worker_name]`,n.worker_name),r.append(`workers[${i}][role]`,n.role),r.append(`workers[${i}][hours_worked]`,n.hours_worked),r.append(`workers[${i}][tasks_performed]`,n.tasks_performed)}),a.forEach((n,i)=>{n.id&&r.append(`materials[${i}][id]`,n.id.toString()),r.append(`materials[${i}][material_name]`,n.material_name),r.append(`materials[${i}][quantity]`,n.quantity),r.append(`materials[${i}][unit]`,n.unit),r.append(`materials[${i}][unit_cost]`,n.unit_cost),r.append(`materials[${i}][supplier]`,n.supplier),r.append(`materials[${i}][notes]`,n.notes)}),d.forEach((n,i)=>{r.append(`delete_images[${i}]`,n.toString())}),u.forEach((n,i)=>{r.append(`images[${i}]`,n.file),r.append(`captions[${i}]`,n.caption)}),C(!0),T.post(`/site-work/log/${l.id}`,r,{onFinish:()=>C(!1)})};return e.jsxs(O,{children:[e.jsx(F,{meta:S}),e.jsxs("section",{className:"relative pt-36 pb-12 md:pt-44 md:pb-16 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-brand-950"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top,rgba(245,158,11,0.08),transparent_60%)]"}),e.jsx("div",{className:"relative container-custom",children:e.jsxs(p,{variant:"fade-up",children:[e.jsxs(W,{href:`/site-work/log/${l.id}`,className:"inline-flex items-center gap-2 text-gray-400 hover:text-accent transition-colors mb-6",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Work Log"]}),e.jsx("h1",{className:"text-3xl sm:text-4xl font-display font-bold text-white",children:"Edit Work Log"}),e.jsxs("p",{className:"text-gray-400 mt-2",children:[M.title," â€¢ ",l.work_date.split("T")[0]]})]})})]}),e.jsx("section",{className:"py-12 md:py-16 bg-brand-950",children:e.jsx("div",{className:"container-custom max-w-4xl",children:e.jsxs("form",{onSubmit:P,className:"space-y-8",children:[e.jsx(p,{variant:"fade-up",children:e.jsxs("div",{className:"card-modern rounded-2xl p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl font-display font-semibold text-white mb-6",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label-modern",children:"Date *"}),e.jsx("input",{type:"date",value:o.work_date,onChange:t=>c("work_date",t.target.value),className:"input-modern w-full",required:!0}),b.work_date&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:b.work_date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-modern",children:"Weather"}),e.jsxs("select",{value:o.weather_conditions,onChange:t=>c("weather_conditions",t.target.value),className:"input-modern w-full",children:[e.jsx("option",{value:"",children:"Select weather..."}),G.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-modern",children:"Start Time"}),e.jsx("input",{type:"time",value:o.start_time,onChange:t=>c("start_time",t.target.value),className:"input-modern w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-modern",children:"End Time"}),e.jsx("input",{type:"time",value:o.end_time,onChange:t=>c("end_time",t.target.value),className:"input-modern w-full"})]})]})]})}),e.jsx(p,{variant:"fade-up",delay:100,children:e.jsxs("div",{className:"card-modern rounded-2xl p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl font-display font-semibold text-white mb-6",children:"Work Description *"}),e.jsx("textarea",{value:o.work_description,onChange:t=>c("work_description",t.target.value),rows:5,className:"input-modern w-full",placeholder:"Describe what was done today...",required:!0}),b.work_description&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:b.work_description})]})}),e.jsx(p,{variant:"fade-up",delay:150,children:e.jsxs("div",{className:"card-modern rounded-2xl p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-display font-semibold text-white",children:"Workers"}),e.jsx("button",{type:"button",onClick:E,className:"btn-secondary text-sm",children:"+ Add Worker"})]}),e.jsx("div",{className:"space-y-4",children:h.map((t,s)=>e.jsxs("div",{className:"p-4 bg-brand-900/50 rounded-xl border border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-400",children:["Worker ",s+1]}),h.length>1&&e.jsx("button",{type:"button",onClick:()=>I(s),className:"text-red-400 hover:text-red-300 text-sm",children:"Remove"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label-modern text-xs",children:"Name"}),e.jsx("input",{type:"text",value:t.worker_name,onChange:a=>N(s,"worker_name",a.target.value),className:"input-modern w-full text-sm",placeholder:"Worker name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-modern text-xs",children:"Role"}),e.jsxs("select",{value:t.role,onChange:a=>N(s,"role",a.target.value),className:"input-modern w-full text-sm",children:[e.jsx("option",{value:"",children:"Select role..."}),V.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-modern text-xs",children:"Hours"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:t.hours_worked,onChange:a=>N(s,"hours_worked",a.target.value),className:"input-modern w-full text-sm",placeholder:"8"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-modern text-xs",children:"Tasks"}),e.jsx("input",{type:"text",value:t.tasks_performed,onChange:a=>N(s,"tasks_performed",a.target.value),className:"input-modern w-full text-sm",placeholder:"Tasks performed"})]})]})]},s))})]})}),e.jsx(p,{variant:"fade-up",delay:200,children:e.jsxs("div",{className:"card-modern rounded-2xl p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-display font-semibold text-white",children:"Materials Used"}),e.jsx("button",{type:"button",onClick:A,className:"btn-secondary text-sm",children:"+ Add Material"})]}),e.jsx("div",{className:"space-y-4",children:x.map((t,s)=>e.jsxs("div",{className:"p-4 bg-brand-900/50 rounded-xl border border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-400",children:["Material ",s+1]}),x.length>1&&e.jsx("button",{type:"button",onClick:()=>q(s),className:"text-red-400 hover:text-red-300 text-sm",children:"Remove"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"label-modern text-xs",children:"Material"}),e.jsx("input",{type:"text",value:t.material_name,onChange:a=>g(s,"material_name",a.target.value),className:"input-modern w-full text-sm",placeholder:"e.g., Cement"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-modern text-xs",children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.quantity,onChange:a=>g(s,"quantity",a.target.value),className:"input-modern w-full text-sm",placeholder:"10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-modern text-xs",children:"Unit"}),e.jsx("select",{value:t.unit,onChange:a=>g(s,"unit",a.target.value),className:"input-modern w-full text-sm",children:z.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-modern text-xs",children:"Unit Cost"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.unit_cost,onChange:a=>g(s,"unit_cost",a.target.value),className:"input-modern w-full text-sm",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-modern text-xs",children:"Supplier"}),e.jsx("input",{type:"text",value:t.supplier,onChange:a=>g(s,"supplier",a.target.value),className:"input-modern w-full text-sm",placeholder:"Supplier"})]})]})]},s))})]})}),e.jsx(p,{variant:"fade-up",delay:250,children:e.jsxs("div",{className:"card-modern rounded-2xl p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl font-display font-semibold text-white mb-6",children:"Additional Information"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label-modern",children:"Difficulties Encountered"}),e.jsx("textarea",{value:o.difficulties,onChange:t=>c("difficulties",t.target.value),rows:3,className:"input-modern w-full",placeholder:"Any challenges or problems faced..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-modern",children:"Safety Notes"}),e.jsx("textarea",{value:o.safety_notes,onChange:t=>c("safety_notes",t.target.value),rows:2,className:"input-modern w-full",placeholder:"Any safety concerns or incidents..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-modern",children:"Additional Notes"}),e.jsx("textarea",{value:o.additional_notes,onChange:t=>c("additional_notes",t.target.value),rows:2,className:"input-modern w-full",placeholder:"Any other relevant information..."})]})]})]})}),e.jsx(p,{variant:"fade-up",delay:275,children:e.jsxs("div",{className:"card-modern rounded-2xl p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-display font-semibold text-white",children:"Work Images"}),e.jsxs("button",{type:"button",onClick:()=>{var t;return(t=j.current)==null?void 0:t.click()},className:"btn-secondary text-sm",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Add Images"]}),e.jsx("input",{ref:j,type:"file",multiple:!0,accept:"image/*",onChange:R,className:"hidden"})]}),k.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-4",children:"Existing Images"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:k.map(t=>e.jsxs("div",{className:`relative group ${d.includes(t.id)?"opacity-50":""}`,children:[e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-brand-800",children:e.jsx("img",{src:`/storage/${t.image_path}`,alt:t.caption||"Work image",className:"w-full h-full object-cover"})}),e.jsx("button",{type:"button",onClick:()=>H(t.id),className:`absolute top-2 right-2 p-1.5 rounded-full text-white transition-opacity ${d.includes(t.id)?"bg-green-500 opacity-100":"bg-red-500 opacity-0 group-hover:opacity-100"}`,children:d.includes(t.id)?e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),d.includes(t.id)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 rounded-lg",children:e.jsx("span",{className:"text-white text-sm font-medium",children:"Will be deleted"})}),t.caption&&e.jsx("p",{className:"text-gray-400 text-sm mt-2 truncate",children:t.caption})]},t.id))})]}),u.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-4",children:"New Images"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:u.map((t,s)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-brand-800",children:e.jsx("img",{src:t.preview,alt:`Preview ${s+1}`,className:"w-full h-full object-cover"})}),e.jsx("button",{type:"button",onClick:()=>B(s),className:"absolute top-2 right-2 p-1.5 bg-red-500 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("input",{type:"text",value:t.caption,onChange:a=>D(s,a.target.value),className:"input-modern w-full text-sm mt-2",placeholder:"Caption (optional)"})]},s))})]}),k.length===0&&u.length===0?e.jsxs("div",{onClick:()=>{var t;return(t=j.current)==null?void 0:t.click()},className:"border-2 border-dashed border-brand-700/50 rounded-xl p-8 text-center cursor-pointer hover:border-accent/50 transition-colors",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto text-gray-500 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-gray-400 mb-2",children:"Click to upload images of work done"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Supports JPEG, PNG, GIF, WebP (max 5MB each)"})]}):e.jsx("div",{onClick:()=>{var t;return(t=j.current)==null?void 0:t.click()},className:"border-2 border-dashed border-brand-700/50 rounded-xl p-4 text-center cursor-pointer hover:border-accent/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"text-gray-400",children:"Add more images"})]})})]})}),e.jsx(p,{variant:"fade-up",delay:300,children:e.jsxs("div",{className:"flex items-center justify-end gap-4",children:[e.jsx(W,{href:`/site-work/log/${l.id}`,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:_,className:"btn-primary",children:_?"Saving...":"Update Work Log"})]})})]})})})]})}export{K as default};
